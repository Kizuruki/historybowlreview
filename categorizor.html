<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Bowl Question Categorizer</title>
    <style>
        /* ... existing styles ... */
        .category-header {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #5a67d8;
        }
        .category-questions {
            margin-top: 20px;
        }
        .category-question {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #3b82f6;
        }
        .category-question .question-text {
            font-weight: 600;
            margin-bottom: 8px;
        }
        .category-question .answer-text {
            font-size: 0.9rem;
            color: #1e40af;
        }
        .category-name-display {
            font-weight: bold;
            color: #5a67d8;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .category-questions-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 8px;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>History Bowl Question Categorizer</h1>
        
        <div class="upload-section">
            <h3>Import Your JSON File</h3>
            <p style="margin: 10px 0; color: #64748b;">Upload a JSON file containing your History Bowl questions</p>
            <div class="file-input">
                <label for="jsonFile" class="file-label">Choose JSON File</label>
                <input type="file" id="jsonFile" accept=".json">
            </div>
            <div style="margin: 15px 0;">
                <button id="importCategoriesBtn" class="btn secondary">Import Existing Categories</button>
            </div>
            <div id="fileInfo" style="margin-top: 15px; color: #64748b;"></div>
        </div>
        
        <div id="progressSection" class="progress-section">
            <h3>Categorization Progress</h3>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <p id="progressText">0 of 0 questions categorized</p>
        </div>
        
        <!-- Question categorization section -->
        <div id="questionCard" class="question-card">
            <div class="question-header">
                <div id="questionCounter" class="question-counter">Question 1 of 100</div>
                <div style="color: #64748b; font-size: 0.9rem;" id="quarterInfo">Quarter 1</div>
            </div>
            
            <div id="questionText" class="question-text">
                Question text will appear here...
            </div>
            
            <div id="answerText" class="answer-text">
                <strong>Answer:</strong> Answer will appear here...
            </div>
            
            <div class="skip-info">
                <strong>Tip:</strong> Click a category button or press the number key (1-9, 0) to quickly categorize. Press 'S' to skip.
            </div>
            
            <h4 style="margin-bottom: 15px; color: #5a67d8;">Select Category:</h4>
            <div class="categories-grid">
                <div class="category-btn" data-category="us-history" data-key="1">1. US History</div>
                <div class="category-btn" data-category="european-history" data-key="2">2. European History</div>
                <div class="category-btn" data-category="world-history" data-key="3">3. World History</div>
                <div class="category-btn" data-category="ancient-history" data-key="4">4. Ancient History</div>
                <div class="category-btn" data-category="other-history" data-key="5">5. Other History</div>
                <div class="category-btn" data-category="pop-culture-sports" data-key="6">6. Pop Culture/Sports</div>
                <div class="category-btn" data-category="social-science" data-key="7">7. Social Science/Philosophy</div>
                <div class="category-btn" data-category="recent-history" data-key="8">8. Recent History (2000-Present)</div>
                <div class="category-btn" data-category="literature-history" data-key="9">9. Literature History</div>
                <div class="category-btn" data-category="fine-arts" data-key="0">0. Fine Arts History</div>
                <div class="category-btn" data-category="geographical-history" data-key="q">Q. Geographical History</div>
                <div class="category-btn" data-category="math-science" data-key="w">W. Math and Science History</div>
                <div class="category-btn" data-category="mythology" data-key="e">E. Mythology</div>
            </div>
            
            <div class="navigation-buttons">
                <button id="skipBtn" class="btn secondary">Skip (S)</button>
                <button id="prevBtn" class="btn secondary" disabled>Previous</button>
                <button id="nextBtn" class="btn" disabled>Next</button>
            </div>
        </div>
        
        <!-- Category-level categorization section -->
        <div id="categoryCard" class="question-card" style="display: none;">
            <div class="question-header">
                <div class="question-counter">Category Categorization</div>
            </div>
            
            <div class="category-header">
                <div class="category-name-display" id="categoryNameDisplay">Category Name</div>
                <div id="categoryDescription">Category Description</div>
            </div>
            
            <div class="category-questions-container">
                <h4>Questions in this Category:</h4>
                <div id="categoryQuestionsList"></div>
            </div>
            
            <h4 style="margin: 20px 0 15px; color: #5a67d8;">Select Category for this Category:</h4>
            <div class="categories-grid">
                <div class="category-btn" data-category="us-history" data-key="1">1. US History</div>
                <div class="category-btn" data-category="european-history" data-key="2">2. European History</div>
                <div class="category-btn" data-category="world-history" data-key="3">3. World History</div>
                <div class="category-btn" data-category="ancient-history" data-key="4">4. Ancient History</div>
                <div class="category-btn" data-category="other-history" data-key="5">5. Other History</div>
                <div class="category-btn" data-category="pop-culture-sports" data-key="6">6. Pop Culture/Sports</div>
                <div class="category-btn" data-category="social-science" data-key="7">7. Social Science/Philosophy</div>
                <div class="category-btn" data-category="recent-history" data-key="8">8. Recent History (2000-Present)</div>
                <div class="category-btn" data-category="literature-history" data-key="9">9. Literature History</div>
                <div class="category-btn" data-category="fine-arts" data-key="0">0. Fine Arts History</div>
                <div class="category-btn" data-category="geographical-history" data-key="q">Q. Geographical History</div>
                <div class="category-btn" data-category="math-science" data-key="w">W. Math and Science History</div>
                <div class="category-btn" data-category="mythology" data-key="e">E. Mythology</div>
            </div>
            
            <div class="navigation-buttons">
                <button id="skipCategoryBtn" class="btn secondary">Skip Category</button>
                <button id="prevCategoryBtn" class="btn secondary">Previous</button>
                <button id="nextCategoryBtn" class="btn">Next Category</button>
            </div>
        </div>
        
        <!-- Results section -->
        <div id="resultsSection" class="results-section" style="display: none;">
            <h3 style="margin-bottom: 20px; color: #5a67d8;">Categorization Complete!</h3>
            
            <div id="categorySummary" class="category-summary">
                <!-- Summary cards will be inserted here -->
            </div>
            
            <div class="export-section">
                <h4 style="margin-bottom: 15px;">Export Categories</h4>
                <p style="color: #64748b; margin-bottom: 15px;">Download JSON files for each category with questions</p>
                <div id="exportButtons" class="export-buttons">
                    <!-- Export buttons will be inserted here -->
                </div>
                <div style="margin-top: 20px;">
                    <button id="exportAllBtn" class="btn success">Export All Categories</button>
                    <button id="startOverBtn" class="btn secondary">Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ... existing code ...
        
        let questions = [];
        let currentQuestionIndex = 0;
        let categorizedQuestions = {};
        let categorizedCategories = {};
        let jsonData = null;
        let importedCategories = {};
        let currentCategoryIndex = 0;
        let categoryQuestions = [];
        let isCategorizingCategories = false;
        
        // ... existing code ...
        
        // Add new event listeners for category navigation
        document.getElementById('skipCategoryBtn').addEventListener('click', skipCategory);
        document.getElementById('prevCategoryBtn').addEventListener('click', previousCategory);
        document.getElementById('nextCategoryBtn').addEventListener('click', nextCategory);
        
        // ... existing code ...
        
        function parseQuestions() {
            questions = [];
            categorizedCategories = {};
            
            // Parse Q1
            if (jsonData.q1) {
                jsonData.q1.forEach((q, index) => {
                    questions.push({
                        quarter: 'q1',
                        index: index,
                        question: q.question,
                        answer: q.answer,
                        category: null
                    });
                });
            }
            
            // Parse Q2 (tossups)
            if (jsonData.q2) {
                jsonData.q2.forEach((q, index) => {
                    questions.push({
                        quarter: 'q2',
                        index: index,
                        question: q.tossup.question,
                        answer: q.tossup.answer,
                        bonus: q.bonus,
                        category: null
                    });
                });
            }
            
            // Parse Q3 categories
            if (jsonData.q3) {
                jsonData.q3.forEach((cat, catIndex) => {
                    // Store category info for categorization
                    categorizedCategories[catIndex] = {
                        category: cat.category,
                        prompt: cat.prompt,
                        questions: cat.questions,
                        category: null
                    };
                    
                    // Add questions to main questions list
                    cat.questions.forEach((q, qIndex) => {
                        questions.push({
                            quarter: 'q3',
                            categoryIndex: catIndex,
                            index: qIndex,
                            categoryName: cat.category,
                            question: q.question,
                            answer: q.answer,
                            category: null
                        });
                    });
                });
            }
            
            // Parse Q4
            if (jsonData.q4) {
                jsonData.q4.forEach((group, groupIndex) => {
                    questions.push({
                        quarter: 'q4',
                        index: groupIndex,
                        question: group.parts.join(' '),
                        answer: group.answer,
                        parts: group.parts,
                        category: null
                    });
                });
            }
        }
        
        function showCategoryCategorization() {
            if (currentCategoryIndex >= Object.keys(categorizedCategories).length) {
                showResults();
                return;
            }
            
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('categoryCard').style.display = 'block';
            
            const categoryIndex = Object.keys(categorizedCategories)[currentCategoryIndex];
            const categoryData = categorizedCategories[categoryIndex];
            
            document.getElementById('categoryNameDisplay').textContent = categoryData.category;
            document.getElementById('categoryDescription').textContent = 
                categoryData.prompt ? `Prompt: ${categoryData.prompt}` : 'No prompt provided';
            
            // Display all questions in this category
            const questionsContainer = document.getElementById('categoryQuestionsList');
            questionsContainer.innerHTML = '';
            
            categoryData.questions.forEach((q, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'category-question';
                questionDiv.innerHTML = `
                    <div class="question-text">Q${qIndex + 1}: ${q.question}</div>
                    <div class="answer-text">Answer: ${Array.isArray(q.answer) ? q.answer.join(', ') : q.answer}</div>
                `;
                questionsContainer.appendChild(questionDiv);
            });
            
            // Clear previous selection
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Show current selection if any
            if (categoryData.category) {
                const selectedBtn = document.querySelector(`[data-category="${categoryData.category}"]`);
                if (selectedBtn) selectedBtn.classList.add('selected');
            }
            
            // Update navigation buttons
            document.getElementById('prevCategoryBtn').disabled = currentCategoryIndex === 0;
            document.getElementById('nextCategoryBtn').disabled = false;
        }
        
        function selectCategoryForCategory(category) {
            const categoryIndex = Object.keys(categorizedCategories)[currentCategoryIndex];
            categorizedCategories[categoryIndex].category = category;
            
            // Update UI
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('selected');
            
            document.getElementById('nextCategoryBtn').disabled = false;
            
            // Auto-advance after short delay
            setTimeout(() => {
                nextCategory();
            }, 500);
        }
        
        function skipCategory() {
            nextCategory();
        }
        
        function nextCategory() {
            currentCategoryIndex++;
            showCategoryCategorization();
        }
        
        function previousCategory() {
            if (currentCategoryIndex > 0) {
                currentCategoryIndex--;
                showCategoryCategorization();
            }
        }
        
        function showResults() {
            // Organize questions by category and quarter
            questions.forEach(q => {
                if (q.category) {
                    const originalQuestion = getOriginalQuestionData(q);
                    categorizedQuestions[q.category][q.quarter].push(originalQuestion);
                }
            });
            
            // Also categorize Q3 categories
            Object.keys(categorizedCategories).forEach(catIndex => {
                const catData = categorizedCategories[catIndex];
                if (catData.category) {
                    // Add the entire category to the appropriate category
                    const categoryData = {
                        category: catData.category,
                        prompt: catData.prompt,
                        questions: catData.questions
                    };
                    categorizedQuestions[catData.category].q3.push(categoryData);
                }
            });
            
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('categoryCard').style.display = 'none';
            document.getElementById('progressSection').style.display = 'none';
            
            displaySummary();
            displayExportButtons();
            document.getElementById('resultsSection').style.display = 'block';
        }
        
        function getOriginalQuestionData(q) {
            if (q.quarter === 'q1') {
                return {
                    question: q.question,
                    answer: q.answer
                };
            } else if (q.quarter === 'q2') {
                return {
                    tossup: {
                        question: q.question,
                        answer: q.answer
                    },
                    bonus: q.bonus
                };
            } else if (q.quarter === 'q3') {
                return {
                    category: q.categoryName,
                    questions: [{
                        question: q.question,
                        answer: q.answer
                    }]
                };
            } else if (q.quarter === 'q4') {
                return {
                    parts: q.parts,
                    answer: q.answer
                };
            }
        }
        
        // Add event listeners for category buttons
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (isCategorizingCategories) {
                    selectCategoryForCategory(btn.dataset.category);
                } else {
                    selectCategory(btn.dataset.category);
                }
            });
        });
        
        // Add key press handling for category categorization
        function handleKeyPress(event) {
            if (document.getElementById('questionCard').style.display === 'none' && 
                document.getElementById('categoryCard').style.display === 'none') {
                return;
            }
            
            const key = event.key.toLowerCase();
            const keyMappings = {
                '1': 'us-history',
                '2': 'european-history',
                '3': 'world-history',
                '4': 'ancient-history',
                '5': 'other-history',
                '6': 'pop-culture-sports',
                '7': 'social-science',
                '8': 'recent-history',
                '9': 'literature-history',
                '0': 'fine-arts',
                'q': 'geographical-history',
                'w': 'math-science',
                'e': 'mythology',
                's': 'skip'
            };
            
            if (keyMappings[key]) {
                event.preventDefault();
                if (key === 's') {
                    if (document.getElementById('categoryCard').style.display === 'block') {
                        skipCategory();
                    } else {
                        skipQuestion();
                    }
                } else {
                    if (document.getElementById('categoryCard').style.display === 'block') {
                        selectCategoryForCategory(keyMappings[key]);
                    } else {
                        selectCategory(keyMappings[key]);
                    }
                }
            } else if (key === 'arrowleft' && currentQuestionIndex > 0) {
                event.preventDefault();
                previousQuestion();
            } else if (key === 'arrowright' && questions[currentQuestionIndex].category) {
                event.preventDefault();
                nextQuestion();
            }
        }
        
        // ... rest of existing code ...
    </script>
</body>
</html>
