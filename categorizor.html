<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Bowl Question Categorizer</title>
    <style>
        *{box-sizing:border-box;margin:0;padding:0}
        body{
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            min-height:100vh;color:#222;padding:24px;
        }
        .container{max-width:1100px;margin:0 auto;background:transparent}
        .upload-section{
            background:rgba(255,255,255,0.95);padding:20px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.12);margin-bottom:20px
        }
        .btn{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:white;
            border:none;
            padding:10px 16px;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
            transition:all 0.2s ease;
            font-size:14px;
            box-shadow:0 2px 8px rgba(102,126,234,0.3);
            margin:5px;
        }
        .btn:hover{
            transform:translateY(-1px);
            box-shadow:0 4px 12px rgba(102,126,234,0.4);
        }
        .btn.secondary{
            background:linear-gradient(135deg,#6c757d 0%,#5a6268 100%);
            box-shadow:0 2px 8px rgba(108,117,125,0.3);
        }
        .btn.success{
            background:linear-gradient(135deg,#28a745 0%,#20c997 100%);
            box-shadow:0 2px 8px rgba(40,167,69,0.3);
        }
        .progress-section{
            background:rgba(255,255,255,0.95);padding:20px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.12);margin-bottom:20px;display:none
        }
        .progress-bar{
            height:20px;background:#e2e8f0;border-radius:10px;overflow:hidden;margin:15px 0
        }
        .progress-fill{
            height:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:10px;width:0;transition:width 0.3s ease
        }
        .question-card{
            background:rgba(255,255,255,0.95);padding:25px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.12);margin-bottom:20px
        }
        .question-header{
            display:flex;justify-content:space-between;align-items:center;margin-bottom:20px
        }
        .question-counter{
            font-weight:700;font-size:1.1rem;color:#5a67d8
        }
        .question-text{
            font-size:1.05rem;color:#2d3748;min-height:62px;line-height:1.5;margin-bottom:15px
        }
        .answer-text{
            font-weight:600;color:#2d3748;margin-bottom:20px
        }
        .skip-info{
            color:#64748b;font-size:0.9rem;margin-bottom:20px
        }
        .categories-grid{
            display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-bottom:20px
        }
        .category-btn{
            padding:14px 16px;border-radius:10px;background:white;border:2px solid #e2e8f0;cursor:pointer;text-align:center;transition:all 0.2s ease;font-weight:500;box-shadow:0 2px 8px rgba(0,0,0,0.06);
        }
        .category-btn:hover{
            border-color:#5a67d8;transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,0,0,0.1);
        }
        .category-btn.selected{
            background:linear-gradient(135deg,#5a67d8 0%,#764ba2 100%);color:white;border-color:#5a67d8;box-shadow:0 4px 12px rgba(90,103,216,0.3);
        }
        .navigation-buttons{
            display:flex;gap:10px;justify-content:flex-end;margin-top:20px
        }
        .results-section{
            background:rgba(255,255,255,0.95);padding:25px;border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,0.12);display:none
        }
        .category-summary{
            display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;margin-bottom:30px
        }
        .summary-card{
            background:linear-gradient(135deg,#f8f9fa 0%,#ffffff 100%);padding:20px;border-radius:10px;text-align:center;box-shadow:0 4px 12px rgba(0,0,0,0.06)
        }
        .summary-count{
            font-size:2rem;font-weight:800;color:#5a67d8;margin-bottom:10px
        }
        .summary-label{
            font-weight:600;color:#2d3748;font-size:1.1rem
        }
        .export-buttons{
            display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;margin-bottom:25px
        }
        .file-input{
            display:flex;align-items:center;gap:10px;margin-bottom:15px
        }
        .file-label{
            background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
            color:white;
            padding:10px 16px;
            border-radius:8px;
            cursor:pointer;
            font-weight:600;
            transition:all 0.2s ease;
        }
        #jsonFile{
            display:none
        }
        .category-header {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #5a67d8;
        }
        .category-questions {
            margin-top: 20px;
        }
        .category-question {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #3b82f6;
        }
        .category-question .question-text {
            font-weight: 600;
            margin-bottom: 8px;
        }
        .category-question .answer-text {
            font-size: 0.9rem;
            color: #1e40af;
        }
        .category-name-display {
            font-weight: bold;
            color: #5a67d8;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        .category-questions-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
            background: #f8f9ff;
            border-radius: 8px;
            margin-top: 15px;
        }
        @media (max-width:700px){
            .question-header{flex-direction:column;gap:10px;text-align:center}
            .navigation-buttons{flex-direction:column}
            .navigation-buttons .btn{width:100%}
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>History Bowl Question Categorizer</h1>
        
        <div class="upload-section">
            <h3>Import Your JSON File</h3>
            <p style="margin: 10px 0; color: #64748b;">Upload a JSON file containing your History Bowl questions</p>
            <div class="file-input">
                <label for="jsonFile" class="file-label">Choose JSON File</label>
                <input type="file" id="jsonFile" accept=".json">
            </div>
            <div style="margin: 15px 0;">
                <button id="importCategoriesBtn" class="btn secondary">Import Existing Categories</button>
            </div>
            <div id="fileInfo" style="margin-top: 15px; color: #64748b;"></div>
        </div>
        
        <div id="progressSection" class="progress-section">
            <h3>Categorization Progress</h3>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <p id="progressText">0 of 0 questions categorized</p>
        </div>
        
        <!-- Question categorization section -->
        <div id="questionCard" class="question-card">
            <div class="question-header">
                <div id="questionCounter" class="question-counter">Question 1 of 100</div>
                <div style="color: #64748b; font-size: 0.9rem;" id="quarterInfo">Quarter 1</div>
            </div>
            
            <div id="questionText" class="question-text">
                Question text will appear here...
            </div>
            
            <div id="answerText" class="answer-text">
                <strong>Answer:</strong> Answer will appear here...
            </div>
            
            <div class="skip-info">
                <strong>Tip:</strong> Click a category button or press the number key (1-9, 0) to quickly categorize. Press 'S' to skip.
            </div>
            
            <h4 style="margin-bottom: 15px; color: #5a67d8;">Select Category:</h4>
            <div class="categories-grid">
                <div class="category-btn" data-category="us-history" data-key="1">1. US History</div>
                <div class="category-btn" data-category="european-history" data-key="2">2. European History</div>
                <div class="category-btn" data-category="world-history" data-key="3">3. World History</div>
                <div class="category-btn" data-category="ancient-history" data-key="4">4. Ancient History</div>
                <div class="category-btn" data-category="other-history" data-key="5">5. Other History</div>
                <div class="category-btn" data-category="pop-culture-sports" data-key="6">6. Pop Culture/Sports</div>
                <div class="category-btn" data-category="social-science" data-key="7">7. Social Science/Philosophy</div>
                <div class="category-btn" data-category="recent-history" data-key="8">8. Recent History (2000-Present)</div>
                <div class="category-btn" data-category="literature-history" data-key="9">9. Literature History</div>
                <div class="category-btn" data-category="fine-arts" data-key="0">0. Fine Arts History</div>
                <div class="category-btn" data-category="geographical-history" data-key="q">Q. Geographical History</div>
                <div class="category-btn" data-category="math-science" data-key="w">W. Math and Science History</div>
                <div class="category-btn" data-category="mythology" data-key="e">E. Mythology</div>
            </div>
            
            <div class="navigation-buttons">
                <button id="skipBtn" class="btn secondary">Skip (S)</button>
                <button id="prevBtn" class="btn secondary" disabled>Previous</button>
                <button id="nextBtn" class="btn" disabled>Next</button>
            </div>
        </div>
        
        <!-- Category-level categorization section -->
        <div id="categoryCard" class="question-card" style="display: none;">
            <div class="question-header">
                <div class="question-counter">Category Categorization</div>
            </div>
            
            <div class="category-header">
                <div class="category-name-display" id="categoryNameDisplay">Category Name</div>
                <div id="categoryDescription">Category Description</div>
            </div>
            
            <div class="category-questions-container">
                <h4>Questions in this Category:</h4>
                <div id="categoryQuestionsList"></div>
            </div>
            
            <h4 style="margin: 20px 0 15px; color: #5a67d8;">Select Category for this Category:</h4>
            <div class="categories-grid">
                <div class="category-btn" data-category="us-history" data-key="1">1. US History</div>
                <div class="category-btn" data-category="european-history" data-key="2">2. European History</div>
                <div class="category-btn" data-category="world-history" data-key="3">3. World History</div>
                <div class="category-btn" data-category="ancient-history" data-key="4">4. Ancient History</div>
                <div class="category-btn" data-category="other-history" data-key="5">5. Other History</div>
                <div class="category-btn" data-category="pop-culture-sports" data-key="6">6. Pop Culture/Sports</div>
                <div class="category-btn" data-category="social-science" data-key="7">7. Social Science/Philosophy</div>
                <div class="category-btn" data-category="recent-history" data-key="8">8. Recent History (2000-Present)</div>
                <div class="category-btn" data-category="literature-history" data-key="9">9. Literature History</div>
                <div class="category-btn" data-category="fine-arts" data-key="0">0. Fine Arts History</div>
                <div class="category-btn" data-category="geographical-history" data-key="q">Q. Geographical History</div>
                <div class="category-btn" data-category="math-science" data-key="w">W. Math and Science History</div>
                <div class="category-btn" data-category="mythology" data-key="e">E. Mythology</div>
            </div>
            
            <div class="navigation-buttons">
                <button id="skipCategoryBtn" class="btn secondary">Skip Category</button>
                <button id="prevCategoryBtn" class="btn secondary">Previous</button>
                <button id="nextCategoryBtn" class="btn">Next Category</button>
            </div>
        </div>
        
        <!-- Results section -->
        <div id="resultsSection" class="results-section" style="display: none;">
            <h3 style="margin-bottom: 20px; color: #5a67d8;">Categorization Complete!</h3>
            
            <div id="categorySummary" class="category-summary">
                <!-- Summary cards will be inserted here -->
            </div>
            
            <div class="export-section">
                <h4 style="margin-bottom: 15px;">Export Categories</h4>
                <p style="color: #64748b; margin-bottom: 15px;">Download JSON files for each category with questions</p>
                <div id="exportButtons" class="export-buttons">
                    <!-- Export buttons will be inserted here -->
                </div>
                <div style="margin-top: 20px;">
                    <button id="exportAllBtn" class="btn success">Export All Categories</button>
                    <button id="startOverBtn" class="btn secondary">Start Over</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let questions = [];
        let currentQuestionIndex = 0;
        let categorizedQuestions = {};
        let categorizedCategories = {};
        let jsonData = null;
        let importedCategories = {};
        let currentCategoryIndex = 0;
        let categoryQuestions = [];
        let isCategorizingCategories = false;
        
        // Category mappings
        const categories = {
            "us-history": "US History",
            "european-history": "European History", 
            "world-history": "World History",
            "ancient-history": "Ancient History",
            "other-history": "Other History",
            "pop-culture-sports": "Pop Culture/Sports",
            "social-science": "Social Science/Philosophy",
            "recent-history": "Recent History (2000-Present)",
            "literature-history": "Literature History",
            "fine-arts": "Fine Arts History",
            "geographical-history": "Geographical History",
            "math-science": "Math and Science History",
            "mythology": "Mythology"
        };
        
        // Initialize categorized questions structure
        Object.keys(categories).forEach(key => {
            categorizedQuestions[key] = { q1: [], q2: [], q3: [], q4: [] };
        });
        
        // File upload handling
        document.getElementById('jsonFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    jsonData = JSON.parse(e.target.result);
                    parseQuestions();
                    showProgress();
                    showQuestion();
                    document.getElementById('fileInfo').textContent = 
                        `Loaded: ${questions.length} questions from ${file.name}`;
                } catch (err) {
                    document.getElementById('fileInfo').textContent = 
                        `Error loading file: ${err.message}`;
                }
            };
            reader.readAsText(file);
        });
        
        // Parse questions from JSON data
        function parseQuestions() {
            questions = [];
            categorizedCategories = {};
            
            // Parse Q1
            if (jsonData.q1) {
                jsonData.q1.forEach((q, index) => {
                    questions.push({
                        quarter: 'q1',
                        index: index,
                        question: q.question,
                        answer: q.answer,
                        category: null
                    });
                });
            }
            
            // Parse Q2 (tossups)
            if (jsonData.q2) {
                jsonData.q2.forEach((q, index) => {
                    questions.push({
                        quarter: 'q2',
                        index: index,
                        question: q.tossup.question,
                        answer: q.tossup.answer,
                        bonus: q.bonus,
                        category: null
                    });
                });
            }
            
            // Parse Q3 categories
            if (jsonData.q3) {
                jsonData.q3.forEach((cat, catIndex) => {
                    // Store category info for categorization
                    categorizedCategories[catIndex] = {
                        category: cat.category,
                        prompt: cat.prompt,
                        questions: cat.questions,
                        category: null
                    };
                    
                    // Add questions to main questions list
                    cat.questions.forEach((q, qIndex) => {
                        questions.push({
                            quarter: 'q3',
                            categoryIndex: catIndex,
                            index: qIndex,
                            categoryName: cat.category,
                            question: q.question,
                            answer: q.answer,
                            category: null
                        });
                    });
                });
            }
            
            // Parse Q4
            if (jsonData.q4) {
                jsonData.q4.forEach((group, groupIndex) => {
                    questions.push({
                        quarter: 'q4',
                        index: groupIndex,
                        question: group.parts.join(' '),
                        answer: group.answer,
                        parts: group.parts,
                        category: null
                    });
                });
            }
        }
        
        // Show progress bar
        function showProgress() {
            document.getElementById('progressSection').style.display = 'block';
            updateProgress();
        }
        
        // Update progress bar
        function updateProgress() {
            const categorized = questions.filter(q => q.category).length;
            const total = questions.length;
            const percentage = total > 0 ? (categorized / total) * 100 : 0;
            
            document.getElementById('progressFill').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = 
                `${categorized} of ${total} questions categorized (${Math.round(percentage)}%)`;
        }
        
        // Show current question
        function showQuestion() {
            document.getElementById('questionCard').style.display = 'block';
            document.getElementById('categoryCard').style.display = 'none';
            
            const q = questions[currentQuestionIndex];
            document.getElementById('questionText').textContent = q.question;
            document.getElementById('answerText').innerHTML = `<strong>Answer:</strong> ${Array.isArray(q.answer) ? q.answer.join(', ') : q.answer}`;
            document.getElementById('questionCounter').textContent = 
                `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            document.getElementById('quarterInfo').textContent = 
                `Quarter ${q.quarter.charAt(1)}`;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').disabled = currentQuestionIndex === questions.length - 1;
        }
        
        // Select category for a question
        function selectCategory(category) {
            const q = questions[currentQuestionIndex];
            q.category = category;
            
            // For Q2 questions, also categorize the bonus
            if (q.quarter === 'q2' && q.bonus) {
                // Bonus questions should be categorized with tossup
                // We'll handle this by including bonus in same category
            }
            
            updateProgress();
            
            // Move to next question
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                // Check if we need to categorize categories
                if (Object.keys(categorizedCategories).length > 0) {
                    isCategorizingCategories = true;
                    currentCategoryIndex = 0;
                    showCategoryCategorization();
                } else {
                    showResults();
                }
            }
        }
        
        // Skip current question
        function skipQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                showResults();
            }
        }
        
        // Navigation functions
        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }
        
        // Category-level categorization functions
        function showCategoryCategorization() {
            if (currentCategoryIndex >= Object.keys(categorizedCategories).length) {
                showResults();
                return;
            }
            
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('categoryCard').style.display = 'block';
            
            const categoryIndex = Object.keys(categorizedCategories)[currentCategoryIndex];
            const categoryData = categorizedCategories[categoryIndex];
            
            document.getElementById('categoryNameDisplay').textContent = categoryData.category;
            document.getElementById('categoryDescription').textContent = 
                categoryData.prompt ? `Prompt: ${categoryData.prompt}` : 'No prompt provided';
            
            // Display all questions in this category
            const questionsContainer = document.getElementById('categoryQuestionsList');
            questionsContainer.innerHTML = '';
            
            categoryData.questions.forEach((q, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'category-question';
                questionDiv.innerHTML = `
                    <div class="question-text">Q${qIndex + 1}: ${q.question}</div>
                    <div class="answer-text">Answer: ${Array.isArray(q.answer) ? q.answer.join(', ') : q.answer}</div>
                `;
                questionsContainer.appendChild(questionDiv);
            });
            
            // Clear previous selection
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Show current selection if any
            if (categoryData.category) {
                const selectedBtn = document.querySelector(`[data-category="${categoryData.category}"]`);
                if (selectedBtn) selectedBtn.classList.add('selected');
            }
            
            // Update navigation buttons
            document.getElementById('prevCategoryBtn').disabled = currentCategoryIndex === 0;
            document.getElementById('nextCategoryBtn').disabled = false;
        }
        
        function selectCategoryForCategory(category) {
            const categoryIndex = Object.keys(categorizedCategories)[currentCategoryIndex];
            categorizedCategories[categoryIndex].category = category;
            
            // Update UI
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`[data-category="${category}"]`).classList.add('selected');
            
            document.getElementById('nextCategoryBtn').disabled = false;
            
            // Auto-advance after short delay
            setTimeout(() => {
                nextCategory();
            }, 500);
        }
        
        function skipCategory() {
            nextCategory();
        }
        
        function nextCategory() {
            currentCategoryIndex++;
            showCategoryCategorization();
        }
        
        function previousCategory() {
            if (currentCategoryIndex > 0) {
                currentCategoryIndex--;
                showCategoryCategorization();
            }
        }
        
        function showResults() {
            // Organize questions by category and quarter
            questions.forEach(q => {
                if (q.category) {
                    const originalQuestion = getOriginalQuestionData(q);
                    categorizedQuestions[q.category][q.quarter].push(originalQuestion);
                }
            });
            
            // Also categorize Q3 categories
            Object.keys(categorizedCategories).forEach(catIndex => {
                const catData = categorizedCategories[catIndex];
                if (catData.category) {
                    // Add the entire category to the appropriate category
                    const categoryData = {
                        category: catData.category,
                        prompt: catData.prompt,
                        questions: catData.questions
                    };
                    categorizedQuestions[catData.category].q3.push(categoryData);
                }
            });
            
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('categoryCard').style.display = 'none';
            document.getElementById('progressSection').style.display = 'none';
            
            displaySummary();
            displayExportButtons();
            document.getElementById('resultsSection').style.display = 'block';
        }
        
        function getOriginalQuestionData(q) {
            if (q.quarter === 'q1') {
                return {
                    question: q.question,
                    answer: q.answer
                };
            } else if (q.quarter === 'q2') {
                return {
                    tossup: {
                        question: q.question,
                        answer: q.answer
                    },
                    bonus: q.bonus
                };
            } else if (q.quarter === 'q3') {
                return {
                    category: q.categoryName,
                    questions: [{
                        question: q.question,
                        answer: q.answer
                    }]
                };
            } else if (q.quarter === 'q4') {
                return {
                    parts: q.parts,
                    answer: q.answer
                };
            }
        }
        
        function displaySummary() {
            const summaryContainer = document.getElementById('categorySummary');
            summaryContainer.innerHTML = '';
            
            Object.keys(categories).forEach(categoryKey => {
                const categoryData = categorizedQuestions[categoryKey];
                const total = categoryData.q1.length + categoryData.q2.length + 
                             categoryData.q3.length + categoryData.q4.length;
                
                if (total > 0) {
                    const card = document.createElement('div');
                    card.className = 'summary-card';
                    card.innerHTML = `
                        <div class="summary-count">${total}</div>
                        <div class="summary-label">${categories[categoryKey]}</div>
                    `;
                    summaryContainer.appendChild(card);
                }
            });
        }
        
        function displayExportButtons() {
            const container = document.getElementById('exportButtons');
            container.innerHTML = '';
            
            Object.keys(categories).forEach(categoryKey => {
                const categoryData = categorizedQuestions[categoryKey];
                const total = categoryData.q1.length + categoryData.q2.length + 
                             categoryData.q3.length + categoryData.q4.length;
                
                if (total > 0) {
                    const btn = document.createElement('button');
                    btn.className = 'btn';
                    btn.textContent = `Export ${categories[categoryKey]} (${total})`;
                    btn.onclick = () => exportCategory(categoryKey);
                    container.appendChild(btn);
                }
            });
        }
        
        function exportCategory(categoryKey) {
            // Merge imported questions with newly categorized ones
            const mergedData = {
                q1: [...categorizedQuestions[categoryKey].q1],
                q2: [...categorizedQuestions[categoryKey].q2], 
                q3: [...categorizedQuestions[categoryKey].q3],
                q4: [...categorizedQuestions[categoryKey].q4]
            };
            
            const filename = `${categoryKey.replace(/-/g, '_')}_questions.json`;
            downloadJSON(mergedData, filename);
        }
        
        function exportAllCategories() {
            Object.keys(categories).forEach(categoryKey => {
                const categoryData = categorizedQuestions[categoryKey];
                const total = categoryData.q1.length + categoryData.q2.length + 
                             categoryData.q3.length + categoryData.q4.length;
                
                if (total > 0) {
                    setTimeout(() => exportCategory(categoryKey), 100);
                }
            });
        }
        
        function downloadJSON(data, filename) {
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        function startOver() {
            questions = [];
            currentQuestionIndex = 0;
            categorizedQuestions = {};
            importedCategories = {};
            jsonData = null;
            
            // Reset categories
            Object.keys(categories).forEach(key => {
                categorizedQuestions[key] = { q1: [], q2: [], q3: [], q4: [] };
                importedCategories[key] = { q1: [], q2: [], q3: [], q4: [] };
            });
            
            // Reset UI
            document.getElementById('jsonFile').value = '';
            document.getElementById('fileInfo').textContent = '';
            document.getElementById('progressSection').style.display = 'none';
            document.getElementById('questionCard').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
        }
        
        // Event listeners
        document.getElementById('skipBtn').addEventListener('click', skipQuestion);
        document.getElementById('prevBtn').addEventListener('click', previousQuestion);
        document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        
        // Category navigation
        document.getElementById('skipCategoryBtn').addEventListener('click', skipCategory);
        document.getElementById('prevCategoryBtn').addEventListener('click', previousCategory);
        document.getElementById('nextCategoryBtn').addEventListener('click', nextCategory);
        
        // Export buttons
        document.getElementById('exportAllBtn').addEventListener('click', exportAllCategories);
        document.getElementById('startOverBtn').addEventListener('click', startOver);
        
        // Category buttons
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (isCategorizingCategories) {
                    selectCategoryForCategory(btn.dataset.category);
                } else {
                    selectCategory(btn.dataset.category);
                }
            });
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (document.getElementById('questionCard').style.display === 'none' && 
                document.getElementById('categoryCard').style.display === 'none') {
                return;
            }
            
            const key = event.key.toLowerCase();
            const keyMappings = {
                '1': 'us-history',
                '2': 'european-history',
                '3': 'world-history',
                '4': 'ancient-history',
                '5': 'other-history',
                '6': 'pop-culture-sports',
                '7': 'social-science',
                '8': 'recent-history',
                '9': 'literature-history',
                '0': 'fine-arts',
                'q': 'geographical-history',
                'w': 'math-science',
                'e': 'mythology',
                's': 'skip'
            };
            
            if (keyMappings[key]) {
                event.preventDefault();
                if (key === 's') {
                    if (document.getElementById('categoryCard').style.display === 'block') {
                        skipCategory();
                    } else {
                        skipQuestion();
                    }
                } else {
                    if (document.getElementById('categoryCard').style.display === 'block') {
                        selectCategoryForCategory(keyMappings[key]);
                    } else {
                        selectCategory(keyMappings[key]);
                    }
                }
            } else if (key === 'arrowleft' && currentQuestionIndex > 0) {
                event.preventDefault();
                previousQuestion();
            } else if (key === 'arrowright' && questions[currentQuestionIndex].category) {
                event.preventDefault();
                nextQuestion();
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize categorized questions structure
            Object.keys(categories).forEach(key => {
                categorizedQuestions[key] = { q1: [], q2: [], q3: [], q4: [] };
            });
        });
    </script>
</body>
</html>
